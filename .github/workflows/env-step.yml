name: Step ENV Variable

on: [push]

# üåé WORKFLOW LEVEL ENV (Used as a fallback/default)
env:
  PROJECT_VERSION: 'v1.0.0-default'
  ENVIRONMENT_TYPE: 'dev'
  
jobs:
  
  # 1. BUILD JOB
  build:
    runs-on: ubuntu-latest
    steps:
        
      - name: Report Build Version
        # ‚úÖ STEP LEVEL ENV: Variables defined here only apply to this 'run' block
        env:
          PROJECT_VERSION: 'v2.5.00000-beta'
          ENVIRONMENT_TYPE: 'build'
        run: |
          echo "Building package for version: ${{ env.PROJECT_VERSION }}"
          echo "Configuration target: ${{ env.ENVIRONMENT_TYPE }}"
          
  # 2. TEST JOB
  test:
    runs-on: ubuntu-latest
    needs: [build]
    steps:
      
      - name: Run Unit Tests (Overridden)
        # ‚úÖ STEP LEVEL ENV: Overrides flow/job vars for this step
        env:
          PROJECT_VERSION: 'v2.5.1-beta-test'
          ENVIRONMENT_TYPE: 'staging-test'
        run: |
          echo "--- Starting Tests ---"
          echo "Testing against code base: ${{ env.PROJECT_VERSION }}"
          echo "Running unit tests for ${{ env.ENVIRONMENT_TYPE }} environment..."

      - name: Run Integration Tests (Using Defaults/Fallback)
        # ‚ùå NO STEP LEVEL ENV: Will fall back to any JOB or WORKFLOW level env vars
        run: |
          echo "--- Starting Integration Tests ---"
          echo "Using default version: ${{ env.PROJECT_VERSION }}"
          echo "Using default env: ${{ env.ENVIRONMENT_TYPE }}"
            

  # 3. DEPLOY JOB
  deploy:
    runs-on: ubuntu-latest
    needs: [test] 
    
    steps:

      - name: Deploy to Production
        # ‚úÖ STEP LEVEL ENV: Final override for the critical step
        env:
          PROJECT_VERSION: 'v2.5.1111111-beta-prod'
          ENVIRONMENT_TYPE: 'prod'
        run: |
          echo "--- Deployment Started ---"
          echo "Deploying ${{ env.PROJECT_VERSION }} to ${{ env.ENVIRONMENT_TYPE }}..."
          echo "Deployment successful."